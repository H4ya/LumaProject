<!DOCTYPE html>
<html class="light" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Luma - Manage Users</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@100..900&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
        rel="stylesheet" />
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#197fe6",
                        "accent": {
                            DEFAULT: "#f59e0b",
                            hover: "#d97706",
                            dark: "#facc15"
                        },
                        "background-light": "#f6f7f8",
                        "background-dark": "#111921",
                        "card-light": "#ffffff",
                        "card-dark": "#1d2a37",
                        "element-light": "#e5e7eb",
                        "element-dark": "#374151",
                        "border-light": "#e5e7eb",
                        "border-dark": "#4b5563",
                        "text-light": "#1f2937",
                        "text-dark": "#f9fafb",
                        "subtle-light": "#6b7280",
                        "subtle-dark": "#9ca3af",
                    },
                    fontFamily: {
                        "display": ["Lexend", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.25rem",
                        "lg": "0.5rem",
                        "xl": "0.75rem",
                        "full": "9999px"
                    },
                },
            },
        }

        // --- MODAL JAVASCRIPT ---
        function openEditModal(id, fullName, email) {
            
            document.getElementById('editForm').action = `{% url 'update_user' pk=12345 %}`.replace('12345', id);
            
            // Set initial values in the form fields
            document.getElementById('edit_user_id').value = id;
            document.getElementById('edit_full_name').value = fullName;
            document.getElementById('edit_email').value = email;
            document.getElementById('editModal').classList.remove('hidden');
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.add('hidden');
        }

        function confirmDelete(id, fullName) {
            document.getElementById('delete_user_name').textContent = fullName;
            document.getElementById('deleteModal').classList.remove('hidden');

            // Set the action URL for the hidden deletion form
            const deleteForm = document.getElementById('simpleDeleteForm');
            deleteForm.action = `{% url 'delete_user' pk=12345 %}`.replace('12345', id);
            

            document.getElementById('delete_user_id_hidden').value = id; 
        }

        function closeDeleteModal() {
            document.getElementById('deleteModal').classList.add('hidden');
        }

        
        function submitDeleteForm() {
            // Submit the hidden form. Django handles the deletion and redirect.
            document.getElementById('simpleDeleteForm').submit();
        }

    </script>
    <style>
        .material-symbols-outlined {
            font-variation-settings:
                'FILL' 0,
                'wght' 400,
                'GRAD' 0,
                'opsz' 24;
            font-size: 20px;
        }

        .material-symbols-outlined.text-lg {
            font-size: 18px;
        }
    </style>
</head>

<body class="bg-background-light dark:bg-background-dark font-display">
    <div class="relative flex min-h-screen w-full">
        <aside
            class="flex w-64 flex-col border-r border-slate-200 bg-white p-4 dark:border-slate-800 dark:bg-background-dark">
            <div class="flex flex-col gap-4">
                <div class="flex items-center gap-3">
                    <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10"
                        data-alt="Luma platform logo"
                        style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuCJT18t6wHfURQQ8Z3ht2g6SHUqnIMHcX85F8RqEFO25YUty5UKb-mlsS5DG9AGhf2aPMKo-MBH0MtfDZ2lCQFl6MPjkES8iPWd3BxPzTlVSZanDN9BzdZBhzDss9uMf6cWA0HMuRYwm9BSpW47_kx-0h4cOc35DugHPpGOxDbp-fqUHTPNTiHwzJJ8MKXQ5XyfW83xfBNj0G9Oqm02KA_0TQQdFAabVD9YE4QEfHyychL_PqZo3oclVFOFub9Zgk9GsXFFRA7mqVTJ");'></div>
                    <div class="flex flex-col">
                        <h1 class="text-slate-900 text-base font-medium leading-normal dark:text-slate-200">{{ full_name }}</h1>
                        <p class="text-slate-500 text-sm font-normal leading-normal dark:text-slate-400">Admin Panel</p>
                    </div>
                </div>
                <nav class="mt-4 flex flex-col gap-2">

                    <a class="flex items-center gap-3 rounded-lg px-3 py-2 transition-colors duration-200 hover:bg-slate-100 dark:hover:bg-slate-800"
                        href="{% url 'admin_page' %}">
                        <span class="material-symbols-outlined text-slate-700 dark:text-slate-300">list_alt</span>
                        <p class="text-slate-700 text-sm font-medium leading-normal dark:text-slate-300">Topics</p>
                    </a>

                    <a class="flex items-center gap-3 rounded-lg bg-accent/10 px-3 py-2 transition-colors duration-200"
                        href="{% url 'users' %}">
                        <span class="material-symbols-outlined text-accent dark:text-accent-dark">group</span>
                        <p class="text-sm font-medium leading-normal text-accent dark:text-accent-dark">Users</p>
                    </a>


                    <a class="flex items-center gap-3 rounded-lg px-3 py-2 transition-colors duration-200 hover:bg-slate-100 dark:hover:bg-slate-800"
                        href="{% url 'setting' %}">
                        <span class="material-symbols-outlined text-slate-700 dark:text-slate-300">settings</span>
                        <p class="text-slate-700 text-sm font-medium leading-normal dark:text-slate-300">Settings</p>
                    </a>
                </nav>
            </div>
            <div class="mt-auto flex flex-col gap-4">

                <div class="flex flex-col gap-1">


                    <a class="flex items-center gap-3 rounded-lg px-3 py-2 transition-colors duration-200 hover:bg-slate-100 dark:hover:bg-slate-800"
                        href="{% url 'homepage' %}">
                        <span class="material-symbols-outlined text-slate-700 dark:text-slate-300">logout</span>
                        <p href="{% url 'homepage' %}"
                            class="text-slate-700 text-sm font-medium leading-normal dark:text-slate-300">Log Out</p>
                    </a>
                </div>
            </div>
        </aside>
        <main class="flex-1 p-8">
            <div class="w-full max-w-7xl mx-auto flex flex-col gap-6">
                <header class="flex flex-wrap justify-between items-center gap-4">
                    <h1
                        class="text-text-light dark:text-text-dark text-3xl font-black leading-tight tracking-tight">
                        Manage Users</h1>
                </header>
                <div
                    class="bg-card-light dark:bg-card-dark rounded-xl border border-border-light dark:border-border-dark p-4">
                    <form method="get" action="{% url 'users' %}"
                        class="flex flex-col md:flex-row gap-4 mb-4">
                        <div class="flex-grow">
                            <label class="flex flex-col min-w-40 h-12 w-full">
                                <div class="flex w-full flex-1 items-stretch rounded-lg h-full">
                                    <div
                                        class="text-subtle-light dark:text-subtle-dark flex border-none bg-element-light dark:bg-element-dark items-center justify-center pl-4 rounded-l-lg">
                                        <button type="submit"
                                            class="p-0 m-0 border-none bg-transparent hover:text-yellow-400 transition-colors">
                                            <span class="material-symbols-outlined">search</span>
                                        </button>
                                    </div>
                                    <input name="search" id="search-input"
                                        class="form-input flex h-full min-w-0 flex-1 resize-none overflow-hidden border-l-0 bg-gray-100 px-4 pl-2 text-base font-normal leading-normal text-slate-900 placeholder:text-slate-400 focus:outline-0 focus:ring-2 focus:ring-accent/50 dark:border-none dark:bg-background-dark dark:text-white dark:placeholder:text-slate-400 bg-white"
                                        placeholder="Search by name or email..."
                                        value="{{ search_term|default:'' }}" />
                                    {% if search_term %}
                                    <button type="button"
                                        onclick="document.getElementById('search-input').value = ''; this.form.submit();"
                                        class="text-sm font-medium bg-gray-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300 items-center justify-center px-3 py-1 rounded-r-lg hover:bg-gray-300 dark:hover:bg-slate-600 transition-colors"
                                        title="Clear Search">
                                        Clear
                                    </button>
                                    {% else %}
                                    <div
                                        class="text-subtle-light dark:text-subtle-dark flex border-none bg-element-light dark:bg-element-dark items-center justify-center pr-4 rounded-r-lg invisible">
                                        <span class="material-symbols-outlined">close</span>
                                    </div>
                                    {% endif %}
                                </div>
                            </label>
                        </div>
                    </form>
                </div>
                <div class="overflow-x-auto">
                    <div class="inline-block min-w-full align-middle">
                        <div
                            class="overflow-hidden rounded-lg border border-border-light dark:border-border-dark max-h-64 overflow-y-auto rounded-lg">
                            <table class="min-w-full divide-y divide-border-light dark:divide-border-dark">
                                <thead class="bg-element-light dark:bg-element-dark sticky top-0 z-10">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-subtle-light dark:text-subtle-dark uppercase tracking-wider"
                                            scope="col">User Name</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-subtle-light dark:text-subtle-dark uppercase tracking-wider"
                                            scope="col">Email</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-subtle-light dark:text-subtle-dark uppercase tracking-wider"
                                            scope="col">Actions</th>
                                    </tr>
                                </thead>
                                <tbody
                                    class="bg-card-light dark:bg-card-dark divide-y divide-border-light dark:divide-border-dark">

                                    {% if student_records %}
                                    {% for student in student_records %}

                                    <tr
                                        class="hover:bg-slate-50 dark:hover:bg-slate-800 transition duration-150">
                                        <td
                                            class="px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-900 dark:text-white">
                                            {{ student.full_name }}
                                        </td>
                                        <td
                                            class="px-6 py-4 whitespace-nowrap text-sm text-slate-600 dark:text-slate-300">
                                            {{ student.email }}
                                        </td>
                                        <td
                                            class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                            <div class="flex items-center gap-4">
                                                <button type="button"
                                                    onclick="openEditModal('{{ student.id }}', '{{ student.full_name }}', '{{ student.email }}')"
                                                    class="rounded-full p-2 text-slate-500 transition-all duration-300 hover:bg-accent/10 hover:text-accent hover:scale-110 dark:text-slate-400 dark:hover:bg-accent-dark/10 dark:hover:text-accent-dark"
                                                    title="Edit User">
                                                    <span
                                                        class="material-symbols-outlined text-slate-400 hover:text-yellow-400">edit</span>
                                                </button>
                                                <button type="button"
                                                    onclick="confirmDelete('{{ student.id }}', '{{ student.full_name }}')"
                                                    class="rounded-full p-2 text-slate-500 transition-all duration-300 hover:bg-red-500/10 hover:text-red-500 hover:scale-110 dark:text-slate-400 dark:hover:bg-red-500/10 dark:hover:text-red-500"
                                                    title="Delete User">
                                                    <span
                                                        class="material-symbols-outlined text-lg">delete</span>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                    {% else %}
                                    <tr>
                                        <td colspan="3"
                                            class="px-6 py-8 text-center text-sm text-slate-500 dark:text-slate-400">
                                            No student records found in the database.
                                        </td>
                                    </tr>
                                    {% endif %}

                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <div id="editModal"
        class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black bg-opacity-50 transition-opacity duration-300"
        onclick="if (event.target.id === 'editModal') closeEditModal()">
        <div class="bg-card-light dark:bg-card-dark rounded-xl shadow-2xl w-full max-w-lg mx-4 p-6 transform transition-all duration-300 scale-100">
            <div class="flex justify-between items-center mb-4">
                <h3
                    class="text-xl font-bold text-text-light dark:text-text-dark">
                    Update User</h3>
                <button type="button" onclick="closeEditModal()"
                    class="text-subtle-light dark:text-subtle-dark hover:text-red-500 transition-colors">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            <form method="POST" id="editForm" action="">
                {% csrf_token %} <input type="hidden" id="edit_user_id" name="user_id">

                <div class="mb-4">
                    <label for="edit_full_name"
                        class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Full
                        Name</label>
                    <input type="text" id="edit_full_name" name="full_name" required
                        class="w-full rounded-lg border border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark text-text-light dark:text-text-dark p-3 focus:ring-primary focus:border-primary transition-colors">
                </div>
                <div class="mb-6">
                    <label for="edit_email"
                        class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Email</label>
                    <input type="email" id="edit_email" name="email" required
                        class="w-full rounded-lg border border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark text-text-light dark:text-text-dark p-3 focus:ring-primary focus:border-primary transition-colors">
                </div>

                <div class="flex justify-end gap-3">
                    <button type="button" onclick="closeEditModal()"
                        class="px-4 py-2 text-sm font-medium rounded-lg border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors">
                        Cancel
                    </button>
                    <button type="submit"
                        class="px-4 py-2 text-sm font-medium rounded-lg text-white bg-primary hover:bg-primary/90 transition-colors">
                        Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div id="deleteModal"
        class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black bg-opacity-50 transition-opacity duration-300"
        onclick="if (event.target.id === 'deleteModal') closeDeleteModal()">
        <div class="bg-card-light dark:bg-card-dark rounded-xl shadow-2xl w-full max-w-sm mx-4 p-6 transform transition-all duration-300 scale-100">
            <div class="flex justify-between items-center mb-4">
                <h3
                    class="text-xl font-bold text-red-600 dark:text-red-400">
                    Confirm Deletion</h3>
                <button type="button" onclick="closeDeleteModal()"
                    class="text-subtle-light dark:text-subtle-dark hover:text-red-500 transition-colors">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            <p class="text-slate-700 dark:text-slate-300 mb-6">
                Are you sure you want to delete the user **<span
                    id="delete_user_name" class="font-semibold"></span>**? This action cannot be undone.
            </p>

            <div class="flex justify-end gap-3">
                <button type="button" onclick="closeDeleteModal()"
                    class="px-4 py-2 text-sm font-medium rounded-lg border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors">
                    Cancel
                </button>
                <button type="button" onclick="submitDeleteForm()"
                    class="px-4 py-2 text-sm font-medium rounded-lg text-white bg-red-600 hover:bg-red-700 transition-colors">
                    Delete User
                </button>
            </div>
        </div>
    </div>

    <form method="POST" id="simpleDeleteForm" action="" class="hidden">
        {% csrf_token %} <input type="hidden" id="delete_user_id_hidden" name="user_id"> 
    </form>

</body>

</html>