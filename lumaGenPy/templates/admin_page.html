
<!DOCTYPE html>
<html class="light" lang="en"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Luma - Manage Topics</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Lexend:wght@100..900&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet"/>
<script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "primary": "#197fe6",
            "accent": {
              DEFAULT: "#f59e0b", // Amber 500
              hover: "#d97706",   // Amber 600
              dark: "#facc15"     // Yellow 400 for dark mode text
            },
            "background-light": "#f6f7f8",
            "background-dark": "#111921",
          },
          fontFamily: {
            "display": ["Lexend", "sans-serif"]
          },
          borderRadius: {
            "DEFAULT": "0.25rem",
            "lg": "0.5rem",
            "xl": "0.75rem",
            "full": "9999px"
          },
        },
      },
    }
  </script>
<style>
    .material-symbols-outlined {
      font-variation-settings:
        'FILL' 0,
        'wght' 400,
        'GRAD' 0,
        'opsz' 24;
      font-size: 20px;
    }
  </style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display">
<div class="relative flex min-h-screen w-full">
<aside class="flex w-64 flex-col border-r border-slate-200 bg-white p-4 dark:border-slate-800 dark:bg-background-dark">
<div class="flex flex-col gap-4">
<div class="flex items-center gap-3">
<div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10" data-alt="Luma platform logo" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuCJT18t6wHfURQQ8Z3ht2g6SHUqnIMHcX85F8RqEFO25YUty5UKb-mlsS5DG9AGhf2aPMKo-MBH0MtfDZ2lCQFl6MPjkES8iPWd3BxPzTlVSZanDN9BzdZBhzDss9uMf6cWA0HMuRYwm9BSpW47_kx-0h4cOc35DugHPpGOxDbp-fqUHTPNTiHwzJJ8MKXQ5XyfW83xfBNj0G9Oqm02KA_0TQQdFAabVD9YE4QEfHyychL_PqZo3oclVFOFub9Zgk9GsXFFRA7mqVTJ");'></div>
<div class="flex flex-col">
<h1 class="text-slate-900 text-base font-medium leading-normal dark:text-slate-200">{{ full_name }}</h1>
<p class="text-slate-500 text-sm font-normal leading-normal dark:text-slate-400">Admin Panel</p>
</div>
</div>
<nav class="mt-4 flex flex-col gap-2">

<a class="flex items-center gap-3 rounded-lg bg-accent/10 px-3 py-2 transition-colors duration-200" href="{% url 'admin_page' %}">
<span class="material-symbols-outlined text-accent dark:text-accent-dark">list_alt</span>
<p class="text-sm font-medium leading-normal text-accent dark:text-accent-dark">Topics</p>
</a>

<a class="flex items-center gap-3 rounded-lg px-3 py-2 transition-colors duration-200 hover:bg-slate-100 dark:hover:bg-slate-800" href="{% url 'users' %}">
<span class="material-symbols-outlined text-slate-700 dark:text-slate-300">group</span>
<p class="text-slate-700 text-sm font-medium leading-normal dark:text-slate-300">Users</p>
</a>

<a class="flex items-center gap-3 rounded-lg px-3 py-2 transition-colors duration-200 hover:bg-slate-100 dark:hover:bg-slate-800" href="{% url 'setting' %}">
<span class="material-symbols-outlined text-slate-700 dark:text-slate-300">settings</span>
<p class="text-slate-700 text-sm font-medium leading-normal dark:text-slate-300">Settings</p>
</a>
</nav>
</div>
<div class="mt-auto flex flex-col gap-1">

<a class="flex items-center gap-3 rounded-lg px-3 py-2 transition-colors duration-200 hover:bg-slate-100 dark:hover:bg-slate-800" href="{% url 'homepage' %}">
<span class="material-symbols-outlined text-slate-700 dark:text-slate-300">logout</span>
<p class="text-slate-700 text-sm font-medium leading-normal dark:text-slate-300">Log Out</p>
</a>
</div>
</aside>
<main class="flex flex-1 flex-col p-6 lg:p-8">
<div class="flex flex-wrap items-center justify-between gap-4">
<h1 class="text-slate-900 text-3xl font-black leading-tight tracking-[-0.033em] dark:text-white">Manage Topics</h1>
<a href="{% url 'add_topic' %}" 
   class="flex min-w-[84px] cursor-pointer items-center justify-center gap-2 overflow-hidden rounded-lg bg-accent text-white h-10 px-4 text-sm font-bold leading-normal tracking-[0.015em] transition-all duration-300 hover:bg-accent-hover hover:scale-105 active:scale-95">
    <span class="material-symbols-outlined">add</span>
    <span class="truncate">Add New Topic</span>
</a>

</div>
<div class="mt-6 flex flex-col gap-4 rounded-xl border border-slate-200 bg-white p-4 dark:border-slate-800 dark:bg-slate-900">
    
    <form method="get" action="{% url 'admin_page' %}" class="flex flex-col gap-4">
        <label class="flex h-12 min-w-40 w-full flex-col">
            <div class="flex h-full w-full flex-1 items-stretch rounded-lg">
                
                <div class="flex items-center justify-center rounded-l-lg border-r-0 bg-background-light pl-4 text-slate-500 dark:border-none dark:bg-background-dark dark:text-slate-400">
                    <button type="submit" class="p-0 m-0 border-none bg-transparent hover:text-primary transition-colors" title="Search">
                        <span class="material-symbols-outlined">search</span>
                    </button>
                </div>
                
                <input 
                    name="search" 
                    id="topic-search-input"
                    class="form-input flex h-full min-w-0 flex-1 resize-none overflow-hidden border-l-0 bg-background-light px-4 pl-2 text-base font-normal leading-normal text-slate-900 placeholder:text-slate-500 focus:outline-0 focus:ring-2 focus:ring-accent/50 dark:border-none dark:bg-background-dark dark:text-white dark:placeholder:text-slate-400" 
                    placeholder="Search topics by title..." 
                    value="{{ search_term|default:'' }}"
                />

                {% if search_term %}
                <button type="button" 
                    onclick="document.getElementById('topic-search-input').value = ''; this.form.submit();"
                    class="text-sm font-medium bg-gray-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300 items-center justify-center px-3 py-1 rounded-r-lg hover:bg-gray-300 dark:hover:bg-slate-600 transition-colors"
                    title="Clear Search">
                    Clear
                </button>
                {% else %}
                <div class="text-subtle-light dark:text-subtle-dark flex border-none bg-element-light dark:bg-element-dark items-center justify-center pr-4 rounded-r-lg invisible">
                    <span class="material-symbols-outlined">close</span>
                </div>
                {% endif %}

            </div>
        </label>
    </form>
</form>
</div>
<div class="mt-6 overflow-hidden rounded-xl border border-slate-200 bg-white dark:bg-slate-800 dark:bg-slate-900">
    <div class="overflow-x-auto">
        <div class="max-h-64 overflow-y-auto">
            <table class="w-full text-left text-sm">
                <thead class="border-b border-slate-200 bg-slate-50 text-xs uppercase text-slate-500 dark:border-slate-800 dark:bg-slate-800 dark:text-slate-400 sticky top-0 z-10">
                    <tr>
                        <th class="px-6 py-3 font-medium" scope="col">Title</th>
                        <th class="px-6 py-3 font-medium" scope="col">Status</th>
                        <th class="px-6 py-3 font-medium" scope="col">Last Modified</th>
                        <th class="px-6 py-3 font-medium text-right" scope="col">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% if topics_list %}
                    {% for topic in topics_list %}
                    <tr class="border-b border-slate-200 transition-colors duration-200 hover:bg-slate-50 dark:border-slate-800 dark:hover:bg-slate-800/50">
                        
                        <th class="whitespace-nowrap px-6 py-4 font-medium text-slate-900 dark:text-white" scope="row">
                            {{ topic.title }}
                        </th>

                        <td class="px-6 py-4">
                            {% if topic.status == 'Published' %}
                                <span class="inline-flex items-center rounded-full bg-green-100 px-2 py-0.5 text-xs font-medium text-green-800 dark:bg-green-700/50 dark:text-green-300">
                                    Published
                                </span>
                            {% elif topic.status == 'Draft' %}
                                <span class="inline-flex items-center rounded-full bg-yellow-100 px-2 py-0.5 text-xs font-medium text-yellow-800 dark:bg-yellow-700/50 dark:text-yellow-300">
                                    Draft
                                </span>
                            {% else %}
                                <span class="inline-flex items-center rounded-full bg-gray-100 px-2 py-0.5 text-xs font-medium text-gray-800 dark:bg-slate-700 dark:text-slate-400">
                                    {{ topic.status|default:"N/A" }}
                                </span>
                            {% endif %}
                        </td>

                        <td class="px-6 py-4 text-slate-700 dark:text-slate-300">
                            {{ topic.last_modified|date:"Y-m-d" }}
                        </td>

                        <td class="px-6 py-4 text-right">
                            <div class="flex justify-end gap-2">
                                
                                <button type="button" 
                                    onclick="openUpdate('{{ topic.topic_id }}')" 
                                     class="rounded-full p-2 text-slate-500 transition-all duration-300 hover:bg-accent/10 hover:text-accent hover:scale-110 dark:text-slate-400 dark:hover:bg-accent-dark/10 dark:hover:text-accent-dark" 
                                     title="Edit Topic">
                                    <span class="material-symbols-outlined">edit</span>
                                </button>
                                <button type="button" onclick="confirmDelete('{{ topic.topic_id }}', '{{ topic.title }}')"
                                        class="rounded-full p-2 text-slate-500 transition-all duration-300 hover:bg-red-500/10 hover:text-red-500 hover:scale-110 dark:text-slate-400 dark:hover:bg-red-500/10 dark:hover:text-red-500" title="Delete Topic">
                                    <span class="material-symbols-outlined">delete</span>
                                </button>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                    {% else %}
                    <tr class="border-b border-slate-200 dark:border-slate-800">
                        <td colspan="4" class="px-6 py-8 text-center text-sm text-slate-500 dark:text-slate-400">
                            No topics found in the database.
                        </td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>
</div>
</main>
</div>

    
<div id="addTopicModal" 
    class="fixed inset-0 bg-black/40 flex items-center justify-center hidden z-50" 
    onclick="if (event.target.id === 'addTopicModal') closeModal()">
  <div class="bg-white dark:bg-slate-900 p-6 rounded-xl w-full max-w-lg mx-4 shadow-xl transform transition-all duration-300 scale-100">
    <h2 class="text-xl font-bold mb-4 text-slate-900 dark:text-white">Add New Topic</h2>
    
    <form method="POST" action="{% url 'add_topic' %}"> 
        {% csrf_token %}
        <div class="flex flex-col gap-3">
          
            <input name="title" id="topicTitle" class="form-input rounded-lg p-2 border border-slate-300 dark:border-slate-700 bg-background-light dark:bg-background-dark text-text-light dark:text-white placeholder-slate-400" placeholder="Topic Title" required/>
          
            <textarea name="summary" id="topicSummary" class="form-textarea rounded-lg p-2 border border-slate-300 dark:border-slate-700 bg-background-light dark:bg-background-dark text-text-light dark:text-white placeholder-slate-400" placeholder="Summary "></textarea>
          
            <textarea name="purpose" id="topicPurpose" class="form-textarea rounded-lg p-2 border border-slate-300 dark:border-slate-700 bg-background-light dark:bg-background-dark text-text-light dark:text-white placeholder-slate-400" placeholder="Purpose "></textarea>
          
          </div>

        <div class="flex justify-end gap-3 mt-4">
          <button type="button" onclick="closeModal()" class="px-4 py-2 text-sm font-medium rounded-lg bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300 hover:bg-slate-300 dark:hover:bg-slate-600 transition-colors">Cancel</button>
          
          <button type="submit" class="px-4 py-2 text-sm font-medium rounded-lg bg-accent text-white hover:bg-accent-hover transition-colors">Save Topic</button>
        </div>
    </form>
  </div>
</div>

<div id="deleteTopicModal"
    class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black bg-opacity-50 transition-opacity duration-300"
    onclick="if (event.target.id === 'deleteTopicModal') closeDeleteModal()">
    <div class="bg-white dark:bg-slate-900 rounded-xl shadow-2xl w-full max-w-sm mx-4 p-6 transform transition-all duration-300 scale-100">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-bold text-red-600 dark:text-red-400">Confirm Deletion</h3>
            <button type="button" onclick="closeDeleteModal()"
                class="text-subtle-light dark:text-subtle-dark hover:text-red-500 transition-colors">
                <span class="material-symbols-outlined">close</span>
            </button>
        </div>
        <p class="text-slate-700 dark:text-slate-300 mb-6">
            Are you sure you want to delete the topic **<span
                id="delete_topic_name_display" class="font-semibold"></span>**? This action cannot be undone.
        </p>

        <div class="flex justify-end gap-3">
            <button type="button" onclick="closeDeleteModal()"
                class="px-4 py-2 text-sm font-medium rounded-lg border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors">
                Cancel
            </button>
            <button type="button" onclick="submitDeleteTopicForm()"
                class="px-4 py-2 text-sm font-medium rounded-lg text-white bg-red-600 hover:bg-red-700 transition-colors">
                Delete Topic
            </button>
        </div>
    </div>
</div>

<form method="POST" id="simpleDeleteForm" action="" class="hidden">
    {% csrf_token %} 
    <input type="hidden" id="delete_topic_id_hidden" name="topic_id"> 
</form>
<div id="editTopicModal" 
    class="fixed inset-0 bg-black/40 flex items-center justify-center hidden z-50" 
    onclick="if (event.target.id === 'editTopicModal') closeEditModal()">
  <div class="bg-white dark:bg-slate-900 p-6 rounded-xl w-full max-w-lg mx-4 shadow-xl transform transition-all duration-300 scale-100">
    <h2 class="text-xl font-bold mb-4 text-slate-900 dark:text-white">Update Topic</h2>
    
    <form method="POST" id="editTopicForm" action=""> 
        {% csrf_token %}
        <input type="hidden" id="edit_topic_id" name="topic_id">
        <input type="hidden" name="text" id="editTopicText">

        <div class="flex flex-col gap-3">
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Title</label>
          <input name="title" id="editTopicTitle" class="form-input rounded-lg p-2 border border-slate-300 dark:border-slate-700 bg-background-light dark:bg-background-dark text-text-light dark:text-white placeholder-slate-400" required/>
          
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Summary</label>
          <textarea name="summary" id="editTopicSummary" class="form-textarea rounded-lg p-2 border border-slate-300 dark:border-slate-700 bg-background-light dark:bg-background-dark text-text-light dark:text-white placeholder-slate-400"></textarea>
          
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Purpose</label>
          <textarea name="purpose" id="editTopicPurpose" class="form-textarea rounded-lg p-2 border border-slate-300 dark:border-slate-700 bg-background-light dark:bg-background-dark text-text-light dark:text-white placeholder-slate-400"></textarea>
        </div>

        <div class="flex justify-end gap-3 mt-4">
          <button type="button" onclick="closeEditModal()" class="px-4 py-2 text-sm font-medium rounded-lg bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300 hover:bg-slate-300 dark:hover:bg-slate-600 transition-colors">Cancel</button>
          <button type="submit" class="px-4 py-2 text-sm font-medium rounded-lg bg-accent-dark text-white hover:bg-accent transition-colors">Save Changes</button>
        </div>
    </form>
  </div>
</div>


<script>
function openUpdate(topicId) {
    //  Check if topicId is valid
    if (!topicId) {
        console.error("Error: Topic ID is missing for redirection.");
        alert("Cannot open edit page: Topic ID missing.");
        return;
    }

    //  Generate the URL
    const editUrl = "{% url 'edit_topic' topic_id=99999 %}".replace('99999', topicId);
    
    //  Perform the redirect (GET request)
    window.location.href = editUrl;
} 
function openEditModal(id, title, subtitle, purpose, text) { 
    //  Set the form action URL dynamically
    const updateUrl = `{% url 'update_topic' topic_id=12345 %}`.replace('12345', id); 
   document.getElementById('editTopicForm').action = updateUrl;
    
    //  Populate the input fields in the modal
    document.getElementById('editTopicTitle').value = title;
    
    // FIX: Target the 'editTopicSubtitle' ID
    const subtitleField = document.getElementById('editTopicSubtitle');
    if (subtitleField) {
        subtitleField.value = subtitle;
    }
    
    document.getElementById('editTopicPurpose').value = purpose;
    
    // Handle the hidden topic ID and text field
    document.getElementById('edit_topic_id').value = id;
    document.getElementById('editTopicText').value = text;
    
    //  Display the modal
    document.getElementById('editTopicModal').classList.remove('hidden');
}


function closeEditModal() {
   document.getElementById('editTopicModal').classList.add('hidden');
}

function confirmDelete(id, title) {
  
    document.getElementById('delete_topic_name_display').textContent = title;

 
    const deleteForm = document.getElementById('simpleDeleteForm');
    deleteForm.action = `{% url 'delete_topic' pk=12345 %}`.replace('12345', id); 
    document.getElementById('delete_topic_id_hidden').value = id; 

    document.getElementById('deleteTopicModal').classList.remove('hidden');
}

function closeDeleteModal() {
    document.getElementById('deleteTopicModal').classList.add('hidden');
}

function submitDeleteTopicForm() {

    closeDeleteModal();

    document.getElementById('simpleDeleteForm').submit();
}

     // SEARCH 
    const searchInput = document.querySelector("input[name='search']");
    if (searchInput) {

    }

</script>
</body>
</html>